#! /bin/bash

# override tool behaviour through distro-defaults
FLL_DISTRO_MODE="installed"
if [ -r /etc/default/distro ]; then
	source /etc/default/distro
fi

[ ! "$FLL_DISTRO_MODE" == "live" ] && exit 0

case "$1" in
    configure)
    echo "Replacing /etc/profile, /etc/bash.bashrc and /etc/inputrc"
cat >/etc/profile.new <<EOF
# /etc/profile
umask 022
PATH="/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin:/usr/local/sbin:/usr/local/bin:/usr/games"
[ -e /usr/NX/bin ] && PATH="\$PATH:/usr/NX/bin"
[ "\$UID" = "0" ] || PATH="\$PATH:."
export PATH
# Set LOCALE
if [ -f /etc/sysconfig/i18n ]; then
    . /etc/sysconfig/i18n
    [ -n "\$LANG" ] || LANG="de_DE@euro"
    export LANG
    [ -n "\$LC_CTYPE" ] && export LC_CTYPE || unset LC_CTYPE
    [ -n "\$LC_COLLATE" ] && export LC_COLLATE || unset LC_COLLATE
    [ -n "\$LC_MESSAGES" ] && export LC_MESSAGES || unset LC_MESSAGES
    [ -n "\$LC_NUMERIC" ] && export LC_NUMERIC || unset LC_NUMERIC
    [ -n "\$LC_MONETARY" ] && export LC_MONETARY || unset LC_MONETARY
    [ -n "\$LC_TIME" ] && export LC_TIME || unset LC_TIME
    [ -n "\$LC_ALL" ] && export LC_ALL || unset LC_ALL
    [ -n "\$LANGUAGE" ] && export LANGUAGE || unset LANGUAGE
    [ -n "\$LINGUAS" ] && export LINGUAS || unset LINGUAS
    [ -n "\$_XKB_CHARSET" ] && export _XKB_CHARSET || unset _XKB_CHARSET

    if [ -n "\$SYSFONTACM" ]; then
	case \$SYSFONTACM in
	    iso01*|iso02*|iso15*|koi*|latin2-ucw*)
		if [ "\$TERM" = "linux" ]; then
		    if ls -l /proc/\$\$/fd/0 2>/dev/null | grep -- '-> /dev/tty[0-9]*\$' >/dev/null 2>&1; then
			echo -n -e '\033(K' > /proc/\$\$/fd/0
		    fi
		fi
		;;
	esac
    fi
    unset SYSFONTACM
fi
# END LOCALE
# enable bash completion in interactive shells
[ "\$PS1" -a -f /etc/bash_completion ] && . /etc/bash_completion
TTY=\$(tty)
TTY=\${TTY##*/}
[ -n "\$TTY" ] && PS1="\[[1;36m\]\u@\$TTY[\W]\\\\\$\[[0;39m\] " || PS1="\[[1;36m\][\W]\u\[[0;39m\] "
alias ..="cd .."
alias which="type -path"
alias where="type -all"
alias ll="ls -l --color=auto"
alias l="ls -a --color=auto"
alias rm="rm -i"
alias mv="mv -i"
alias cp="cp -i"
alias la="ls -la --color=auto"
alias ls="ls --color=auto"
EOF
if [ "$FLL_DISTRO_MODE" == "live" ];then
	echo "# This is very KANOTIX-specific"	>> /etc/profile.new
	echo "alias su=\"sudo su\""		>> /etc/profile.new
fi
chmod 644 /etc/profile.new ; mv -f /etc/profile.new /etc/profile
cat >/etc/bash.bashrc.new <<EOF
# /etc/bash.bashrc
[ -f /etc/profile ] && . /etc/profile
EOF
chmod 644 /etc/bash.bashrc.new ; mv -f /etc/bash.bashrc.new /etc/bash.bashrc
cp /etc/bash.bashrc /etc/skel/.bashrc
cat >/etc/inputrc.new <<EOF
# /etc/inputrc
# set bell-style visible
set meta-flag on
set input-meta on
set output-meta on
set convert-meta off

# This is needed for old broken term apps, but may disturb the behaviour of
# some old apps on AIX, ie. screen in xterm
#"\\e[3~": delete-char

# Home and End of application keypad and cursor of xterm
# sucks in dselect
"\\eOH":         beginning-of-line
"\\eOF":         end-of-line
"\\e[H":         beginning-of-line
"\\e[F":         end-of-line
"\\e[1~":         beginning-of-line
"\\e[4~":         end-of-line
"\\e[7~":         beginning-of-line
"\\e[8~":         end-of-line
EOF
chmod 644 /etc/inputrc.new ; mv -f /etc/inputrc.new /etc/inputrc
echo "Done."
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)

    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 0
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
